<!DOCTYPE html>
{% load core_tags static %}
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}{% if page %}{{ page.meta_title|default:page.title|default:"djCMS" }}{% else %}djCMS{% endif %}{% endblock %}</title>
    
    <!-- Meta tags -->
    <meta name="description" content="{% block meta_description %}{% if page %}{{ page.meta_description|default:'' }}{% endif %}{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}{% if page %}{{ page.meta_keywords|default:'' }}{% endif %}{% endblock %}">
    <meta name="author" content="djCMS">
    <meta name="theme-color" content="#4F46E5">
    {% if page and page.canonical_url %}<link rel="canonical" href="{{ page.canonical_url }}">{% endif %}
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="{% block og_title %}{% if page %}{{ page.og_title|default:page.meta_title|default:page.title|default:'djCMS' }}{% else %}djCMS{% endif %}{% endblock %}">
    <meta property="og:description" content="{% block og_description %}{% if page %}{{ page.og_description|default:page.meta_description|default:'' }}{% endif %}{% endblock %}">
    {% if page and page.og_image %}<meta property="og:image" content="{{ page.og_image.url }}">{% endif %}
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="djCMS">
    
    <!-- PWA Support -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="djCMS">
    <meta name="application-name" content="djCMS">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    
    <!-- Favicon -->
    {% if theme.favicon %}
        <link rel="icon" href="{{ theme.favicon.url }}">
        <link rel="icon" type="image/png" sizes="32x32" href="{{ theme.favicon.url }}">
        <link rel="icon" type="image/png" sizes="16x16" href="{{ theme.favicon.url }}">
        <link rel="apple-touch-icon" href="{{ theme.favicon.url }}">
        <link rel="mask-icon" href="{{ theme.favicon.url }}" color="#4F46E5">
    {% endif %}
    
    <!-- Google Fonts - Optimized loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons - With integrity for security -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer">

    <!-- CSS Files -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/custom.css' %}">
    <link rel="stylesheet" href="{% static 'css/mobile-menu-fix.css' %}">
    
    <!-- Theme CSS Variables -->
    <style>
        :root {
            /* Primary Colors */
            --primary-50: {{ theme.primary_color_50|default:'#EEF2FF' }};
            --primary-100: {{ theme.primary_color_100|default:'#E0E7FF' }};
            --primary-200: {{ theme.primary_color_200|default:'#C7D2FE' }};
            --primary-300: {{ theme.primary_color_300|default:'#A5B4FC' }};
            --primary-400: {{ theme.primary_color_400|default:'#818CF8' }};
            --primary-500: {{ theme.primary_color_500|default:'#6366F1' }};
            --primary-600: {{ theme.primary_color|default:'#4F46E5' }};
            --primary-700: {{ theme.primary_color_700|default:'#4338CA' }};
            --primary-800: {{ theme.primary_color_800|default:'#3730A3' }};
            --primary-900: {{ theme.primary_color_900|default:'#312E81' }};
            --primary: {{ theme.primary_color|default:'#4F46E5' }};
            
            /* Secondary Colors */
            --secondary-50: {{ theme.secondary_color_50|default:'#ECFDF5' }};
            --secondary-100: {{ theme.secondary_color_100|default:'#D1FAE5' }};
            --secondary-200: {{ theme.secondary_color_200|default:'#A7F3D0' }};
            --secondary-300: {{ theme.secondary_color_300|default:'#6EE7B7' }};
            --secondary-400: {{ theme.secondary_color_400|default:'#34D399' }};
            --secondary-500: {{ theme.secondary_color_500|default:'#10B981' }};
            --secondary-600: {{ theme.secondary_color|default:'#059669' }};
            --secondary-700: {{ theme.secondary_color_700|default:'#047857' }};
            --secondary-800: {{ theme.secondary_color_800|default:'#065F46' }};
            --secondary-900: {{ theme.secondary_color_900|default:'#064E3B' }};
            --secondary: {{ theme.secondary_color|default:'#10B981' }};
            
            /* Accent Colors */
            --accent-light: {{ theme.accent_color_light|default:'#FBBF24' }};
            --accent: {{ theme.accent_color|default:'#F59E0B' }};
            --accent-dark: {{ theme.accent_color_dark|default:'#D97706' }};
            
            /* Neutral Colors */
            --dark: {{ theme.dark_color|default:'#1E293B' }};
            --light: {{ theme.light_color|default:'#F8FAFC' }};
            --muted: {{ theme.muted_color|default:'#94A3B8' }};
            
            /* Feedback Colors */
            --success: {{ theme.success_color|default:'#10B981' }};
            --danger: {{ theme.danger_color|default:'#EF4444' }};
            --warning: {{ theme.warning_color|default:'#F59E0B' }};
            --info: {{ theme.info_color|default:'#3B82F6' }};
            
            /* Typography */
            --font-sans: {{ theme.font_family|default:'Inter' }}, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            --font-heading: {{ theme.heading_font_family|default:'Playfair Display' }}, Georgia, 'Times New Roman', serif;
            --font-mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace;
            
            /* Layout */
            --container-width: {{ theme.container_width|default:'1280px' }};
        }
    </style>
    
    {% if theme.custom_css %}
    <!-- Custom Theme CSS -->
    <style>
        {{ theme.custom_css|safe }}
    </style>
    {% endif %}
    
    {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">
    <!-- Skip to content link for accessibility -->
    <a href="#main-content" class="skip-to-content">Skip to content</a>
    
    <!-- Header -->
    <header class="bg-white/95 shadow-md sticky top-0 z-50 transition-all duration-300 backdrop-blur-sm">
        <div class="max-w-container mx-auto px-4">
            <!-- Top Bar - Optional for contact info, social links, etc. -->
            <div class="hidden lg:flex justify-between items-center py-2 border-b border-gray-100 text-sm">
                <div class="flex items-center space-x-6">
                    <a href="mailto:info@example.com" class="flex items-center text-gray-600 hover:text-primary transition-colors">
                        <i class="fas fa-envelope mr-2 text-primary-400" aria-hidden="true"></i>
                        <span>info@example.com</span>
                    </a>
                    <a href="tel:+1234567890" class="flex items-center text-gray-600 hover:text-primary transition-colors">
                        <i class="fas fa-phone-alt mr-2 text-primary-400" aria-hidden="true"></i>
                        <span>+1 (234) 567-890</span>
                    </a>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors" aria-label="Twitter">
                        <i class="fab fa-twitter" aria-hidden="true"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors" aria-label="Facebook">
                        <i class="fab fa-facebook-f" aria-hidden="true"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors" aria-label="Instagram">
                        <i class="fab fa-instagram" aria-hidden="true"></i>
                    </a>
                    <a href="#" class="text-gray-600 hover:text-primary transition-colors" aria-label="GitHub">
                        <i class="fab fa-github" aria-hidden="true"></i>
                    </a>
                </div>
            </div>
            
            <!-- Main Navigation Bar -->
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    {% if theme.logo %}
                        <a href="{% url 'pages:home' %}" class="block transition-transform duration-300 hover:scale-105" aria-label="Home">
                            <img src="{{ theme.logo.url }}" alt="{{ site_name }}" class="h-10">
                        </a>
                    {% else %}
                        <a href="{% url 'pages:home' %}" class="text-2xl font-bold font-heading text-gradient" aria-label="Home">
                            djCMS
                        </a>
                    {% endif %}
                </div>
                
                <!-- Desktop Navigation - Compact with Active Underline -->
                <nav class="hidden lg:flex items-center flex-1 justify-center" aria-label="Main navigation">
                    <ul class="flex items-center space-x-6">
                        {% if header_menu %}
                            {% for item in header_menu.items.all %}
                                {% if not item.parent %}
                                    <li class="relative group">
                                        {% with children=item.children.all %}
                                            <a href="{{ item.get_url }}" 
                                               class="px-2 py-4 font-medium text-gray-800 hover:text-primary transition-colors relative 
                                                     {% if request.path == item.get_url %}text-primary after:w-full{% else %}after:w-0{% endif %}
                                                     after:absolute after:bottom-0 after:left-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 group-hover:after:w-full flex items-center"
                                               {% if item.target_blank %}target="_blank" rel="noopener"{% endif %}
                                               {% if children %}aria-expanded="false" aria-haspopup="true"{% endif %}>
                                                {{ item.title }}
                                                {% if children %}
                                                    <i class="fas fa-chevron-down text-xs ml-1 transition-transform duration-300 group-hover:rotate-180" aria-hidden="true"></i>
                                                {% endif %}
                                            </a>
                                            
                                            {% if children %}
                                                <div class="absolute left-1/2 -translate-x-1/2 mt-0 pt-2 w-56 opacity-0 invisible translate-y-2 group-hover:opacity-100 group-hover:visible group-hover:translate-y-0 transition-all duration-300 z-10">
                                                    <div class="bg-white shadow-lg rounded-lg overflow-hidden border border-gray-100">
                                                        <ul role="menu" aria-orientation="vertical" aria-labelledby="menu-button">
                                                            {% for child in children %}
                                                                <li role="none" class="border-b border-gray-50 last:border-0">
                                                                    <a href="{{ child.get_url }}" 
                                                                       class="block px-4 py-2.5 hover:bg-gray-50 hover:text-primary transition-colors flex items-center group/item
                                                                              {% if request.path == child.get_url %}text-primary bg-gray-50 border-l-2 border-primary{% else %}border-l-2 border-transparent{% endif %}"
                                                                       {% if child.target_blank %}target="_blank" rel="noopener"{% endif %}
                                                                       role="menuitem">
                                                                        <span class="w-5 text-primary opacity-0 group-hover/item:opacity-100 transition-all duration-300" aria-hidden="true">
                                                                            <i class="fas fa-chevron-right text-xs group-hover/item:translate-x-1 transition-transform duration-300"></i>
                                                                        </span>
                                                                        <span>{{ child.title }}</span>
                                                                    </a>
                                                                </li>
                                                            {% endfor %}
                                                        </ul>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        {% endwith %}
                                    </li>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        <li class="relative group">
                            <a href="{% url 'blog:post_list' %}" 
                               class="px-2 py-4 font-medium text-gray-800 hover:text-primary transition-colors relative
                                     {% if 'blog' in request.path %}text-primary after:w-full{% else %}after:w-0{% endif %}
                                     after:absolute after:bottom-0 after:left-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 group-hover:after:w-full">
                                Blog
                            </a>
                        </li>
                        <li class="relative group">
                            <a href="{% url 'core:contact' %}" 
                               class="px-2 py-4 font-medium text-gray-800 hover:text-primary transition-colors relative
                                     {% if 'contact' in request.path %}text-primary after:w-full{% else %}after:w-0{% endif %}
                                     after:absolute after:bottom-0 after:left-0 after:h-0.5 after:bg-primary after:transition-all after:duration-300 group-hover:after:w-full">
                                Contact
                            </a>
                        </li>
                    </ul>
                </nav>
                
                <!-- Right Side Actions -->
                <div class="flex items-center space-x-3">
                    <!-- Search Button (Triggers Modal) -->
                    <button type="button" id="search-button" class="p-2.5 text-gray-600 hover:text-primary hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-lg" aria-label="Search">
                        <i class="fas fa-search" aria-hidden="true"></i>
                    </button>
                    
                    <!-- User Menu -->
                    <div class="hidden md:block relative">
                        {% if user.is_authenticated %}
                            <div class="relative">
                                <button id="user-menu-button" class="flex items-center space-x-2 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 hover:bg-gray-100 px-3 py-2 rounded-lg transition-all duration-300" aria-expanded="false" aria-haspopup="true">
                                    {% if user.avatar %}
                                        <img src="{{ user.avatar.url }}" alt="" class="w-8 h-8 rounded-full object-cover border-2 border-primary">
                                    {% else %}
                                        <div class="w-8 h-8 rounded-full gradient-bg text-white flex items-center justify-center" aria-hidden="true">
                                            {{ user.username|first|upper }}
                                        </div>
                                    {% endif %}
                                    <span class="font-medium">{{ user.display_name }}</span>
                                    <i class="fas fa-chevron-down text-xs text-gray-500 transition-transform duration-300" id="user-menu-arrow" aria-hidden="true"></i>
                                </button>
                                
                                <div id="user-dropdown-menu" class="absolute right-0 mt-1 w-64 bg-white shadow-lg rounded-lg py-1 z-10 hidden animate-fade-in border border-gray-100" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button">
                                    <div class="px-4 py-2 border-b border-gray-100">
                                        <p class="text-xs text-gray-500">Signed in as</p>
                                        <p class="font-medium text-gray-900 text-sm truncate">{{ user.email }}</p>
                                    </div>
                                    <a href="{% url 'core:profile' %}" class="flex items-center px-4 py-2 text-sm hover:bg-gray-50 transition-colors group" role="menuitem">
                                        <i class="fas fa-user-circle mr-3 text-primary w-5 group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                        <span>Profile</span>
                                    </a>
                                    <a href="{% url 'blog:author_dashboard' %}" class="flex items-center px-4 py-2 text-sm hover:bg-gray-50 transition-colors group" role="menuitem">
                                        <i class="fas fa-pen-fancy mr-3 text-primary w-5 group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                        <span>Author Dashboard</span>
                                    </a>
                                    {% if user.is_staff %}
                                        <a href="{% url 'admin:index' %}" class="flex items-center px-4 py-2 text-sm hover:bg-gray-50 transition-colors group" role="menuitem">
                                            <i class="fas fa-cog mr-3 text-primary w-5 group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>Admin</span>
                                        </a>
                                    {% endif %}
                                    <div class="border-t border-gray-100 my-1" role="none"></div>
                                    <form action="{% url 'core:logout' %}" method="post" class="m-0">
                                        {% csrf_token %}
                                        <button type="submit" class="flex items-center px-4 py-2 text-sm hover:bg-gray-50 transition-colors group w-full text-left" role="menuitem">
                                            <i class="fas fa-sign-out-alt mr-3 text-primary w-5 group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>Log Out</span>
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% else %}
                            <div class="flex items-center space-x-2">
                                <a href="{% url 'core:register' %}" class="px-4 py-2 text-gray-700 hover:text-primary hover:bg-gray-100 rounded-lg transition-colors font-medium">
                                    Sign Up
                                </a>
                                <a href="{% url 'core:login' %}" class="px-4 py-2 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors font-medium">
                                    Log In
                                </a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mobile Menu Button -->
                    <button class="lg:hidden p-2.5 rounded-lg bg-gray-100 hover:bg-gray-200 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary" id="mobile-menu-button" aria-expanded="false" aria-controls="mobile-menu" aria-label="Toggle menu">
                        <i class="fas fa-bars text-gray-700" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
            
            <!-- Search Modal (Hidden by default) -->
            <div id="search-modal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-start justify-center pt-20">
                <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 overflow-hidden animate-scale-in">
                    <div class="p-4 border-b border-gray-100 flex justify-between items-center">
                        <h3 class="text-lg font-bold">Search</h3>
                        <button id="close-search" class="p-1 rounded-full hover:bg-gray-100 transition-colors">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="p-4">
                        <form action="{% url 'search:search' %}" method="get" class="flex" role="search">
                            <label for="modal-search" class="sr-only">Search</label>
                            <input type="text" id="modal-search" name="q" placeholder="Search for anything..." 
                                   class="flex-grow px-4 py-3 border border-gray-200 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-lg" autofocus>
                            <button type="submit" class="btn-primary rounded-r-lg rounded-l-none px-6" aria-label="Search">
                                <i class="fas fa-search mr-2" aria-hidden="true"></i>
                                <span>Search</span>
                            </button>
                        </form>
                        <div class="mt-4 text-sm text-gray-500">
                            <p>Popular searches: <a href="{% url 'search:search' %}?q=blog" class="text-primary hover:underline">blog</a>, <a href="{% url 'search:search' %}?q=tutorial" class="text-primary hover:underline">tutorial</a>, <a href="{% url 'search:search' %}?q=guide" class="text-primary hover:underline">guide</a></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Navigation Drawer - PWA Optimized -->
            <div class="lg:hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[99999] hidden" id="mobile-menu-backdrop" role="dialog" aria-modal="true" aria-label="Mobile navigation">
                <div id="mobile-menu" class="fixed top-0 right-0 bottom-0 h-full w-[85%] max-w-sm bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out overflow-y-auto flex flex-col z-[100000]" aria-labelledby="mobile-menu-button" style="position: fixed !important;">
                    <!-- Mobile Menu Header with Logo -->
                    <div class="sticky top-0 z-10 flex justify-between items-center p-4 border-b border-gray-100 bg-white">
                        {% if theme.logo %}
                            <img src="{{ theme.logo.url }}" alt="{{ site_name }}" class="h-8">
                        {% else %}
                            <span class="text-xl font-bold font-heading text-gradient">djCMS</span>
                        {% endif %}
                        <button id="close-mobile-menu" class="p-2 rounded-lg hover:bg-gray-100 transition-colors focus:outline-none focus:ring-2 focus:ring-primary" aria-label="Close menu">
                            <i class="fas fa-times" aria-hidden="true"></i>
                        </button>
                    </div>
                    
                    <!-- Mobile User Menu (if authenticated) -->
                    {% if user.is_authenticated %}
                        <div class="p-4 border-b border-gray-100 flex items-center bg-gray-50">
                            {% if user.avatar %}
                                <img src="{{ user.avatar.url }}" alt="" class="w-10 h-10 rounded-full object-cover border-2 border-primary">
                            {% else %}
                                <div class="w-10 h-10 rounded-full gradient-bg text-white flex items-center justify-center" aria-hidden="true">
                                    {{ user.username|first|upper }}
                                </div>
                            {% endif %}
                            <div class="ml-3 flex-1">
                                <p class="font-medium text-gray-900">{{ user.display_name }}</p>
                                <p class="text-xs text-gray-500 truncate">{{ user.email }}</p>
                            </div>
                            <a href="{% url 'core:profile' %}" class="p-2 text-primary hover:text-primary-dark hover:bg-gray-200 rounded-full transition-colors" aria-label="Edit profile">
                                <i class="fas fa-user-edit" aria-hidden="true"></i>
                            </a>
                        </div>
                    {% endif %}
                    
                    <!-- Mobile Search Form -->
                    <div class="p-4 border-b border-gray-100">
                        <form action="{% url 'search:search' %}" method="get" class="relative" role="search">
                            <label for="mobile-search" class="sr-only">Search</label>
                            <input type="text" id="mobile-search" name="q" placeholder="Search..." 
                                   class="w-full px-4 py-3 pl-10 bg-gray-100 border-0 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:bg-white transition-all">
                            <button type="submit" class="absolute left-0 top-0 h-full flex items-center justify-center w-10 text-gray-500" aria-label="Search">
                                <i class="fas fa-search" aria-hidden="true"></i>
                            </button>
                        </form>
                    </div>
                    
                    <!-- Mobile Navigation Links -->
                    <nav aria-label="Mobile navigation" class="flex-grow overflow-y-auto overscroll-contain p-4">
                        <ul class="space-y-2">
                            <li>
                                <a href="{% url 'pages:home' %}" 
                                   class="flex items-center px-4 py-3 rounded-lg font-medium {% if request.path == '/' %}bg-primary/10 text-primary border-l-2 border-primary{% else %}text-gray-800 hover:bg-gray-100{% endif %} transition-colors">
                                    <i class="fas fa-home mr-3 w-5 text-center" aria-hidden="true"></i>
                                    <span>Home</span>
                                </a>
                            </li>
                            
                            {% if header_menu %}
                                {% for item in header_menu.items.all %}
                                    {% if not item.parent %}
                                        <li>
                                            {% with children=item.children.all %}
                                                {% if children %}
                                                    <button type="button" 
                                                            class="mobile-menu-item mobile-dropdown-toggle w-full flex justify-between items-center px-4 py-3 rounded-lg font-medium {% if request.path == item.get_url %}bg-primary/10 text-primary{% else %}text-gray-800 hover:bg-gray-100{% endif %} cursor-pointer transition-colors"
                                                            aria-expanded="false">
                                                        <span class="flex items-center">
                                                            <i class="fas fa-folder mr-3 w-5 text-center" aria-hidden="true"></i>
                                                            <span>{{ item.title }}</span>
                                                        </span>
                                                        <i class="fas fa-chevron-down text-sm transition-transform duration-300" aria-hidden="true"></i>
                                                    </button>
                                                    <div class="hidden mobile-dropdown-menu mt-1 mb-2 ml-4 pl-2 border-l-2 border-gray-200 space-y-1">
                                                        <a href="{{ item.get_url }}" 
                                                           class="mobile-menu-item flex items-center px-4 py-2 rounded-lg {% if request.path == item.get_url %}bg-primary/10 text-primary font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors"
                                                           {% if item.target_blank %}target="_blank" rel="noopener"{% endif %}>
                                                            <i class="fas fa-link mr-3 w-5 text-center opacity-75" aria-hidden="true"></i>
                                                            <span>{{ item.title }} Overview</span>
                                                        </a>
                                                        {% for child in children %}
                                                            <a href="{{ child.get_url }}" 
                                                               class="mobile-menu-item flex items-center px-4 py-2 rounded-lg {% if request.path == child.get_url %}bg-primary/10 text-primary font-medium{% else %}text-gray-700 hover:bg-gray-100{% endif %} transition-colors"
                                                               {% if child.target_blank %}target="_blank" rel="noopener"{% endif %}>
                                                                <i class="fas fa-angle-right mr-3 w-5 text-center opacity-75" aria-hidden="true"></i>
                                                                <span>{{ child.title }}</span>
                                                            </a>
                                                        {% endfor %}
                                                    </div>
                                                {% else %}
                                                    <a href="{{ item.get_url }}" 
                                                       class="mobile-menu-item flex items-center px-4 py-3 rounded-lg font-medium {% if request.path == item.get_url %}bg-primary/10 text-primary border-l-2 border-primary{% else %}text-gray-800 hover:bg-gray-100{% endif %} transition-colors"
                                                       {% if item.target_blank %}target="_blank" rel="noopener"{% endif %}>
                                                        <i class="fas fa-link mr-3 w-5 text-center" aria-hidden="true"></i>
                                                        <span>{{ item.title }}</span>
                                                    </a>
                                                {% endif %}
                                            {% endwith %}
                                        </li>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                            
                            <li>
                                <a href="{% url 'blog:post_list' %}" 
                                   class="flex items-center px-4 py-3 rounded-lg font-medium {% if 'blog' in request.path %}bg-primary/10 text-primary border-l-2 border-primary{% else %}text-gray-800 hover:bg-gray-100{% endif %} transition-colors">
                                    <i class="fas fa-blog mr-3 w-5 text-center" aria-hidden="true"></i>
                                    <span>Blog</span>
                                </a>
                            </li>
                            <li>
                                <a href="{% url 'core:contact' %}" 
                                   class="flex items-center px-4 py-3 rounded-lg font-medium {% if 'contact' in request.path %}bg-primary/10 text-primary border-l-2 border-primary{% else %}text-gray-800 hover:bg-gray-100{% endif %} transition-colors">
                                    <i class="fas fa-envelope mr-3 w-5 text-center" aria-hidden="true"></i>
                                    <span>Contact</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                    
                    <!-- Mobile Action Buttons -->
                    <div class="p-4 border-t border-gray-100">
                        {% if user.is_authenticated %}
                            <div class="grid grid-cols-2 gap-3">
                                {% if user.is_staff %}
                                    <a href="{% url 'admin:index' %}" class="flex justify-center items-center px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors">
                                        <i class="fas fa-cog mr-2" aria-hidden="true"></i>
                                        <span>Admin</span>
                                    </a>
                                {% else %}
                                    <a href="{% url 'blog:author_dashboard' %}" class="flex justify-center items-center px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors">
                                        <i class="fas fa-pen-fancy mr-2" aria-hidden="true"></i>
                                        <span>Dashboard</span>
                                    </a>
                                {% endif %}
                                <form action="{% url 'core:logout' %}" method="post" class="m-0">
                                    {% csrf_token %}
                                    <button type="submit" class="w-full flex justify-center items-center px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors">
                                        <i class="fas fa-sign-out-alt mr-2" aria-hidden="true"></i>
                                        <span>Log Out</span>
                                    </button>
                                </form>
                            </div>
                        {% else %}
                            <div class="grid grid-cols-2 gap-3">
                                <a href="{% url 'core:register' %}" class="flex justify-center items-center px-4 py-2.5 bg-gray-100 hover:bg-gray-200 text-gray-800 rounded-lg transition-colors">
                                    <i class="fas fa-user-plus mr-2" aria-hidden="true"></i>
                                    <span>Sign Up</span>
                                </a>
                                <a href="{% url 'core:login' %}" class="flex justify-center items-center px-4 py-2.5 bg-primary hover:bg-primary-dark text-white rounded-lg transition-colors">
                                    <i class="fas fa-sign-in-alt mr-2" aria-hidden="true"></i>
                                    <span>Log In</span>
                                </a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Social Links & Copyright -->
                    <div class="p-4 border-t border-gray-100 mt-auto">
                        <div class="flex justify-center space-x-3">
                            <a href="#" class="w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors" aria-label="Twitter">
                                <i class="fab fa-twitter text-gray-600" aria-hidden="true"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors" aria-label="Facebook">
                                <i class="fab fa-facebook-f text-gray-600" aria-hidden="true"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors" aria-label="Instagram">
                                <i class="fab fa-instagram text-gray-600" aria-hidden="true"></i>
                            </a>
                            <a href="#" class="w-10 h-10 rounded-lg bg-gray-100 hover:bg-gray-200 flex items-center justify-center transition-colors" aria-label="GitHub">
                                <i class="fab fa-github text-gray-600" aria-hidden="true"></i>
                            </a>
                        </div>
                        <p class="text-center text-xs text-gray-500 mt-4">&copy; {% now "Y" %} djCMS. All rights reserved.</p>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="flex-grow" id="main-content">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Back to top button -->
    <button id="back-to-top" aria-label="Back to top" class="fixed bottom-6 right-6 z-50 p-3 rounded-full bg-primary text-white shadow-lg transform transition-transform duration-300 scale-0 hover:bg-primary-dark focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary">
        <i class="fas fa-arrow-up" aria-hidden="true"></i>
    </button>
    
    <!-- Footer -->
    <footer class="bg-gradient-to-br from-gray-900 to-gray-800 text-white pt-16 pb-8 mt-16" role="contentinfo">
        {% load widget_tags %}
        <div class="max-w-container mx-auto px-4">
            <!-- Footer Top Section with Logo and Newsletter -->
            <div class="flex flex-col lg:flex-row justify-between items-center mb-12 pb-12 border-b border-gray-700/50">
                <div class="mb-8 lg:mb-0 text-center lg:text-left">
                    {% if theme.logo %}
                        <img src="{{ theme.logo.url }}" alt="{{ site_name }}" class="h-12 mb-4 mx-auto lg:mx-0">
                    {% else %}
                        <h2 class="text-3xl font-bold font-heading text-gradient mb-4">djCMS</h2>
                    {% endif %}
                    <p class="text-gray-300 max-w-md">A flexible CMS platform built with Django and Tailwind CSS, designed for modern web development.</p>
                </div>
                
                <div class="w-full max-w-md">
                    <h4 class="font-bold text-lg mb-3 text-center lg:text-left">Subscribe to Our Newsletter</h4>
                    <form class="flex" aria-label="Newsletter subscription">
                        <label for="footer-email" class="sr-only">Email address</label>
                        <input type="email" id="footer-email" placeholder="Your email address" 
                               class="flex-grow px-4 py-3 bg-gray-800 border border-gray-700 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent text-white" required>
                        <button type="submit" class="bg-primary hover:bg-primary-dark px-6 rounded-r-lg text-white transition-colors" aria-label="Subscribe">
                            <span class="hidden sm:inline mr-2">Subscribe</span>
                            <i class="fas fa-paper-plane" aria-hidden="true"></i>
                        </button>
                    </form>
                    <p class="text-gray-400 text-sm mt-2 text-center lg:text-left">Get the latest updates and news directly to your inbox.</p>
                </div>
            </div>
            
            <!-- Footer Main Links Section -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-12">
                <!-- Quick Links Column -->
                <div>
                    {% with template_name="widgets/footer_widget.html" %}
                        {% show_widget_area 'footer-center-left' %}
                    {% endwith %}
                    
                    {% if not widgets %}
                        <h3 class="text-xl font-bold font-heading mb-6 pb-2 border-b border-primary/30">Quick Links</h3>
                        <nav aria-label="Quick links">
                            <ul class="space-y-3">
                                <li>
                                    <a href="{% url 'pages:home' %}" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                        <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                        <span>Home</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url 'blog:post_list' %}" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                        <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                        <span>Blog</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url 'core:contact' %}" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                        <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                        <span>Contact</span>
                                    </a>
                                </li>
                                {% if footer_menu %}
                                    {% for item in footer_menu.items.all %}
                                        {% if not item.parent and forloop.counter <= 3 %}
                                            <li>
                                                <a href="{{ item.get_url }}" 
                                                   class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center"
                                                   {% if item.target_blank %}target="_blank" rel="noopener"{% endif %}>
                                                    <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                                    <span>{{ item.title }}</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                </div>
                
                <!-- Resources Column -->
                <div>
                    {% with template_name="widgets/footer_widget.html" %}
                        {% show_widget_area 'footer-center-right' %}
                    {% endwith %}
                    
                    {% if not widgets %}
                        <h3 class="text-xl font-bold font-heading mb-6 pb-2 border-b border-primary/30">Resources</h3>
                        <nav aria-label="Resources">
                            <ul class="space-y-3">
                                {% if footer_menu %}
                                    {% for item in footer_menu.items.all %}
                                        {% if not item.parent and forloop.counter > 3 %}
                                            <li>
                                                <a href="{{ item.get_url }}" 
                                                   class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center"
                                                   {% if item.target_blank %}target="_blank" rel="noopener"{% endif %}>
                                                    <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                                    <span>{{ item.title }}</span>
                                                </a>
                                            </li>
                                        {% endif %}
                                    {% endfor %}
                                {% else %}
                                    <li>
                                        <a href="#" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                            <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>Documentation</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                            <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>Tutorials</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                            <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>API Reference</span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="#" class="text-gray-300 hover:text-white transition-colors group focus:outline-none focus:text-white flex items-center">
                                            <i class="fas fa-chevron-right text-xs mr-2 text-primary group-hover:translate-x-1 transition-transform duration-300" aria-hidden="true"></i>
                                            <span>Support</span>
                                        </a>
                                    </li>
                                {% endif %}
                            </ul>
                        </nav>
                    {% endif %}
                </div>
                
                <!-- Contact Column -->
                <div>
                    {% with template_name="widgets/footer_widget.html" %}
                        {% show_widget_area 'footer-right' %}
                    {% endwith %}
                    
                    {% if not widgets %}
                        <h3 class="text-xl font-bold font-heading mb-6 pb-2 border-b border-primary/30">Contact Us</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fas fa-map-marker-alt text-primary" aria-hidden="true"></i>
                                </div>
                                <span class="text-gray-300">123 Street Name, City, Country</span>
                            </li>
                            <li class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fas fa-envelope text-primary" aria-hidden="true"></i>
                                </div>
                                <a href="mailto:info@example.com" class="text-gray-300 hover:text-white transition-colors focus:outline-none focus:text-white">info@example.com</a>
                            </li>
                            <li class="flex items-center">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3 flex-shrink-0">
                                    <i class="fas fa-phone-alt text-primary" aria-hidden="true"></i>
                                </div>
                                <a href="tel:+1234567890" class="text-gray-300 hover:text-white transition-colors focus:outline-none focus:text-white">+1 (234) 567-890</a>
                            </li>
                        </ul>
                    {% endif %}
                </div>
                
                <!-- Social Media Column -->
                <div>
                    {% with template_name="widgets/footer_widget.html" %}
                        {% show_widget_area 'footer-left' %}
                    {% endwith %}
                    
                    {% if not widgets %}
                        <h3 class="text-xl font-bold font-heading mb-6 pb-2 border-b border-primary/30">Follow Us</h3>
                        <div class="grid grid-cols-2 gap-3" aria-label="Social media links">
                            <a href="#" class="flex items-center p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors group focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                                    <i class="fab fa-twitter text-primary group-hover:scale-110 transition-transform duration-300" aria-hidden="true"></i>
                                </div>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Twitter</span>
                            </a>
                            <a href="#" class="flex items-center p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors group focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                                    <i class="fab fa-facebook-f text-primary group-hover:scale-110 transition-transform duration-300" aria-hidden="true"></i>
                                </div>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Facebook</span>
                            </a>
                            <a href="#" class="flex items-center p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors group focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                                    <i class="fab fa-instagram text-primary group-hover:scale-110 transition-transform duration-300" aria-hidden="true"></i>
                                </div>
                                <span class="text-gray-300 group-hover:text-white transition-colors">Instagram</span>
                            </a>
                            <a href="#" class="flex items-center p-3 bg-gray-800 hover:bg-gray-700 rounded-lg transition-colors group focus:outline-none focus:ring-2 focus:ring-primary">
                                <div class="w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center mr-3">
                                    <i class="fab fa-github text-primary group-hover:scale-110 transition-transform duration-300" aria-hidden="true"></i>
                                </div>
                                <span class="text-gray-300 group-hover:text-white transition-colors">GitHub</span>
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Footer Bottom Section -->
            <div class="pt-8 border-t border-gray-700/50 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm">&copy; {% now "Y" %} djCMS. All rights reserved.</p>
                <nav aria-label="Legal links" class="mt-4 md:mt-0">
                    <div class="flex flex-wrap justify-center gap-x-6">
                        <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors focus:outline-none focus:text-white">Privacy Policy</a>
                        <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors focus:outline-none focus:text-white">Terms of Service</a>
                        <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors focus:outline-none focus:text-white">Cookie Policy</a>
                    </div>
                </nav>
            </div>
        </div>
    </footer>
    
    <!-- JavaScript Files -->
    <script src="{% static 'js/main.js' %}"></script>
    
    {% if theme.custom_js %}
    <!-- Custom Theme JavaScript -->
    <script>
        {{ theme.custom_js|safe }}
    </script>
    {% endif %}
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>